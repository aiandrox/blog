---
title: "【Hugo】zzoのコードブロックのカスタマイズ"
date: 2020-9-22T18:26:30+09:00
lastmod:
draft: false
tags:
  - Hugo
categories:
  - Hugo
image: images/logos/hugo.png
series:
  - 技術関連
---

## テスト用

````
```
何もなし
```
何もなし
````

````rb
```rb
# 拡張子指定のみ（rb）
puts "test_#{num}"
```
# 拡張子指定のみ（rb）
puts "test_#{num}"
````

````rb:test.rb
```rb:test.rb
# 拡張子・言語指定あり
puts "test_#{num}"
```
# 拡張子・言語指定あり
puts "test_#{num}"
````

````test.rb
```test.rb
# 拡張子のみ
puts "test_#{num}"
```
# 拡張子のみ
puts "test_#{num}"
````

````rb:test..rb
```rb:test..rb
# 言語指定のみ
puts "test_#{num}"
```
# 言語指定のみ
puts "test_#{num}"
````

````rb:test.erb..rb
```rb:test.erb..rb
# 拡張子を強制する
<%= render '_comment' %>
```
# 拡張子を強制する
<%= render '_comment' %>
````

[HugoのコードブロックにQiitaのようなTitleをつける \| AABrain](https://aakira.app/blog/2018/12/code-block-title/)

Hugoのシンタックスハイライトは、ファイル名の`.`の最後を読み取って判定している。
VScodeのマークダウンのシンタックスハイライトはファイル名の前の`:`を読み取って判定している。
というわけで、基本的にエディタで書くときは`:`の前、表示は`.`の後を見ているので、双方で対応することにする。

`..ハイライトを強制したい拡張子`にする。
が、記事上では`..`以降の文字列は表示させない。



## 実装

`themes/zzo/layouts/partials/script/codeblock-script.html`をコピペした後、以下のように編集する。

```html:layouts/partials/script/codeblock-script.html
<script>
  "use strict";
  // 省略
  (function () {
    var singleContentsElem = document.querySelector(".single__contents");
    singleContentsElem
      ? singleContentsElem
          .querySelectorAll("pre > code")
          .forEach(function (elem) {
            var dataLang = elem.getAttribute("data-lang");
            if (!dataLang) return;
            var dataLangWrapper = document.createElement("div");
            // 以下の定義はまあ多分いらないんだけど
            var code = null;
            var codeTitle = null;

            if (!dataLang.includes(".")) {
              // 言語のみ指定のとき
              elem.className = "language-" + dataLang;
              elem.removeAttribute("data-lang");
              return;
            }

            if (dataLang.includes("..")) {
              // 拡張子以外の言語を強制する場合
              code = dataLang.split("..")[1];
              codeTitle = dataLang.split("..")[0].split(":")[1];
            } else if (dataLang.includes(":")) {
              // 普通の拡張子のとき
              code = dataLang.split(":")[0];
              codeTitle = dataLang.split(":")[1];
            } else {
              // :がなくて拡張子のみのとき
              code = dataLang.split(".")[1];
              codeTitle = dataLang;
            }
            elem.className = "language-" + code;
            elem.setAttribute("data-lang", codeTitle);
            dataLangWrapper.setAttribute("data-lang", codeTitle);
          })
      : null;
  })();
  // 省略
</script>
```


<!-- 
## デフォルトの表示

````md
```
2
2,5
3,4
```
````

![plaintext](/images/posts/2020/0829.png)

````md
```rb
print "hello = ",s[0]," , world = ",s[1],"\n"
```
````

![rubycode](/images/posts/2020/0829-2.png)

（´-`）.｡oO（Codeとかrbとかの表示はいらないよなあ）

````md
```ruby:test
print "hello = ",s[0]," , world = ",s[1],"\n"
```
````

![rubycode](/images/posts/2020/0829-3.png)

（´-`）.｡oO（拡張子を識別できなかったときの表示が格好悪いな……）

````md
```rb:test.rb
print "hello = ",s[0]," , world = ",s[1],"\n"
```

```test.rb
print "hello = ",s[0]," , world = ",s[1],"\n"
```
````

![rubycode](/images/posts/2020/0829-4.png)

`ruby:test`はうまく行かなかったが`ruby:test.rb`と`test.rb`は認識してくれるということは、末尾の拡張子で判別しているようです。

Qiita のように、必要なときだけヘッダーが表示されるようにしたかったので、試行錯誤してみました。

## ``` によって生成されるHTML

```html
<div data-lang="Code" class="language-code">
  <pre>
<code>
2
2,5
3,4
</code>
</pre>
  <span class="copy-to-clipboard" title="Copy to clipboard"></span>
</div>
```

```html
<div class="highlight">
  <div class="chroma">
    <table class="lntable">
      <tbody>
        <tr>
          /* ここから左側の行数表示 */
          <td class="lntd">
            <div data-lang="Code" class="language-code">
              <pre class="chroma"><code><span class="lnt">1
</span></code></pre>
              <span class="copy-to-clipboard" title="Copy to clipboard"></span>
            </div>
          </td>
          /* ここから右側のコード */
          <td class="lntd">
            <pre class="chroma"><code class="language-ruby" data-lang="ruby">
  <span class="nb">puts</span> <span class="s2">"hello = </span><span class="si">#{</span><span class="n">s</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2">, world = </span><span class="si">#{</span><span class="n">s</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
            <span class="copy-to-clipboard" title="Copy to clipboard"></span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
```

## 参考リンク

- [HugoのコードブロックにQiitaのようなTitleをつける| AABrain](https://aakira.app/blog/2018/12/code-block-title/)
- [HUGOのマークダウンファイル内のコードブロックでQiitaのように言語名やファイル名を表示させる](https://note.gorogolog.xyz/posts/hugo-codeblock-tag/) -->
